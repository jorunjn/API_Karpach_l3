<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SPA Приложение с Пользователями и Комментариями</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .user-list, .comments-list {
            list-style-type: none;
            padding: 0;
        }
        .user-list li a {
            text-decoration: none;
            color: blue;
            cursor: pointer;
        }
        .user-list li a:hover {
            text-decoration: underline;
        }
        .active {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Пользователи</h1>
    <div id="app">
        <ul class="user-list" id="userList"></ul>
        <div id="commentsSection"></div>
    </div>

    <script>
        const app = document.getElementById('app');
        const userList = document.getElementById('userList');
        const commentsSection = document.getElementById('commentsSection');

        let users = [];
        let posts = [];
        let comments = [];
        async function fetchData() {
            try {
                const [usersRes, postsRes, commentsRes] = await Promise.all([
                    axios.get('https://jsonplaceholder.typicode.com/users'),
                    axios.get('https://jsonplaceholder.typicode.com/posts'),
                    axios.get('https://jsonplaceholder.typicode.com/comments')
                ]);

                users = usersRes.data;
                posts = postsRes.data;
                comments = commentsRes.data;

                renderUserList(users);
                handleRouting();
            } catch (error) {
                console.error('Ошибка при загрузке данных:', error);
                userList.innerHTML = '<li>Не удалось загрузить пользователей.</li>';
            }
        }
        function renderUserList(users) {
            userList.innerHTML = '';
            users.forEach(user => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.textContent = user.name;
                a.href = `#user-${user.id}`;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateToUser(user.id);
                });
                li.appendChild(a);
                userList.appendChild(li);
            });
        }
        function navigateToUser(userId) {
            window.location.hash = `user-${userId}`;
        }

        // Показать комментарии для выбранного пользователя
        function showUserComments(userId) {
            const userPosts = posts.filter(post => post.userId === userId);
            const userPostIds = userPosts.map(p => p.id);

            // Фильтруем комментарии, относящиеся к постам пользователя
            let userComments = comments.filter(comment => userPostIds.includes(comment.postId));

            // Ограничиваем первыми 15
            userComments = userComments.slice(0, 15);

            renderComments(userComments, userId);
        }

        // Рендер комментариев
        function renderComments(userComments, userId) {
            commentsSection.innerHTML = `<h2>Комментарии к постам пользователя ${userId}</h2>`;
            if (userComments.length === 0) {
                commentsSection.innerHTML += '<p>Нет комментариев.</p>';
                return;
            }
            const ul = document.createElement('ul');
            ul.classList.add('comments-list');
            userComments.forEach(comment => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${comment.name}</strong>: ${comment.body}`;
                ul.appendChild(li);
            });
            commentsSection.appendChild(ul);
        }

        // Роутинг
        function handleRouting() {
            const hash = window.location.hash;
            if (hash.startsWith('#user-')) {
                const userId = parseInt(hash.replace('#user-', ''), 10);
                showUserComments(userId);
            } else {
                commentsSection.innerHTML = '';
            }
        }

        window.addEventListener('hashchange', handleRouting);
        fetchData();
    </script>
</body>
</html>
